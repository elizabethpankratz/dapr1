---
title: "Errors, Power, Effect size, Assumptions"
subtitle: "Semester 2 - Week 5"
callout-appearance: simple
editor_options: 
  chunk_output_type: inline
---


```{r setup}
#| include: false

source('assets/setup.R')

# week 1 code: confidence intervals
library(tidyverse)
library(patchwork)
library(kableExtra)

grad <- read_csv("https://uoepsy.github.io/data/dataset-ipeds-2012-subset2.csv")
head(grad)
glimpse(grad)

plt.grad.h <- ggplot(grad, aes(x = gradratew)) +
    geom_histogram(color = 'white')

plt.grad.d <- ggplot(grad, aes(x = gradratew)) +
    geom_density()

plt.grad.b <- ggplot(grad, aes(x = gradratew)) +
    geom_boxplot()

plt.grad.h / plt.grad.b

stats.grad <- grad %>%
    summarise(n = length(gradratew),
              Min = min(gradratew),
              Max = max(gradratew),
              M = mean(gradratew),
              SD = sd(gradratew))

stats.grad %>%
    kbl(digits = 2) %>%
    kable_styling(full_width = FALSE)

psych::describe(grad$gradratew)

xbar <- mean(grad$gradratew)
n <- nrow(grad)
tstar <- qt(c(0.025, 0.975), n - 1)
se <- sd(grad$gradratew) / sqrt(n)
xbar + tstar * se

stats.grad$M + tstar * stats.grad$SD / sqrt(stats.grad$n)

# week 2 code: hypothesis testing (p-value method)
xbar <- mean(grad$gradratew)
n <- nrow(grad)
s <- sd(grad$gradratew)
se <- s / sqrt(n)

tobs <- (xbar - 50) / se
tobs

pvalue <- 2 * pt(abs(tobs), df = n - 1, lower.tail = FALSE)
pvalue

tstar <- qt(c(0.025, 0.975), n - 1)
xbar + tstar * se

t.test(grad$gradratew, mu = 50)


shapiro.test(grad$gradratew)

qqnorm(grad$gradratew)
qqline(grad$gradratew)

dim(grad)


# week 3 code: hypothesis testing (critical value method)
tstar <- qt(c(0.025, 0.975), df = n - 1)
tstar

tobs

tobs >= tstar[2]
tobs <= tstar[1]

# week 4: no code, report formatting

# week 5 code: effect size, assumptions
D <- (xbar - 50) / s
D

ggplot(grad, aes(x = gradratew)) +
    geom_histogram(color = 'white') |
    ggplot(grad, aes(x = gradratew)) +
    geom_density() |
    ggplot(grad, aes(sample = gradratew)) +
    geom_qq() +
    geom_qq_line()
```


::: {.callout-note collapse="true"}
### Submission of Formative Report C (PDF file only)

- You are required to submit a PDF file by 12 noon on Friday the 17th of February 2023 via Learn. One person needs to submit on behalf of your group.

- No extensions allowed. As this is group-based work, no extensions are possible.

- The report should be at most 6 pages long. At the end of the report, you are allowed two appendices which don't count towards the page limit. 

    + Appendix A will contain any tables or figures which you cannot fit in the page limit (no text allowed).
    + Appendix B will contain the code to reproduce the report results.

- Excluding Appendix B, the report should only include text, figures or tables. It should not include any reference to R code or functions, but be written for a generic reader who is only assumed to have a basic statistical understanding without any R knowledge. You should also avoid any R code output or printout in the PDF file. 

- In the author section of the PDF file write your Group name, followed by the exam number of each person within the group. The exam number starts with the letter __B__ (for example B123456) and can be found on your student ID card.

- You will receive formative feedback on your submission during Flexible Learning Week (next week). Please keep going to the labs next week in order to receive feedback.
:::


::: {.callout-important collapse="true"}
### Are you registered for your group on Learn?

Go to the course Learn page, on the left-hand side click "Groups information", then the lab, and then the group name. Click Sign up.
:::



## Tasks

The data __dataset-ipeds-2012-subset2__, available at <https://uoepsy.github.io/data/dataset-ipeds-2012-subset2.csv>, is a subset of data derived from the Integrated Postsecondary Education Data System (IPEDS) at the National Center for Education Statistics, 2012. The variables include:

```{r}
#| echo: false
library(tidyverse)
library(kableExtra)

cb <- tibble(
    Variable = 
        c("type", "region", "gradrate", "gradratem", "gradratew"),
    Description = 
        c("College Type: <br><i>
          −1 = Not reported; <br>
          1 = Public; <br>
          2 = Private for-profit; <br>
          3 = Private not-for-profit (no religious affiliation); <br>
          4 = Private not-for-profit (religious affiliation)</i>", 
          "Region: <br><i>
          0 = US Service schools; <br>
          1 = New England; <br>
          2 = Mid East; <br>
          3 = Great Lakes; <br>
          4 = Plains; <br>
          5 = Southeast; <br>
          6 = Southwest; <br>
          7 = Rocky Mountains; <br>
          8 = Far West; <br>
          9 = Outlying areas</i>", 
          "Graduation Rate – All", 
          "Graduation Rate – Men", 
          "Graduation Rate – Women")
)

cb %>%
    kable(format="html", escape=FALSE) %>%
    kable_styling(full_width = FALSE)
```


In formative report C, you will investigate the mean graduation rate for female students at colleges and universities in the United States. Specifically, you are asked to perform the following tasks, each related to a week of teaching in this course.  

__This week you will only focus on task C4.__

C1) Read the data into R, describe the variable of interest both visually and numerically, and provide a 95% CI for the mean graduation rate of female students at colleges and universities in the United States.  
C2) At the 5% significance level and using the p-value method, test whether the mean graduation rate for female students at colleges and universities in the United States is significantly different from a rate of 50 percent.  
C3) At the 5% significance level and using the critical value method, test whether the mean graduation rate for female students at colleges and universities in the United States is significantly different from a rate of 50 percent.  
C4) Tidy up your report so far, making sure to have 3 sections: introduction, analysis and discussion.  

:::{.callout-note}
### This week's task
C5) Compute and report the effect size, check if the assumptions underlying the t-test are violated.

:::




## C5 sub-tasks

In this section you will find some guided sub-steps you may want to consider to complete task C5.

::: {.callout-tip}
#### Tip

To see the hints, hover your cursor on the superscript numbers.
:::

- Reopen last week's Rmd file, as you will continue last week's work (i.e., the top 3 most frequent movie genres that were rated as 'good' and 'bad'), and build on it.[^share-file]

[^share-file]: Hint: Ask last week's driver for the Rmd file, they should share it with the group via email or Teams. To download the file from the server, go to the RStudio Files pane, tick the box next to the Rmd file, and select More > Export.

- Compute an effect size for the graduation rate of female students.[^cohen-d]

[^cohen-d]: Hint: Cohen's $D$ for a one sample t-test is given by

    $$D = \frac{\bar{x} - \mu_0}{s}$$. 
    
    where $\bar{x}$ is the sample mean, $\mu_0$ is the value for the population mean that we hypothesised in the null hypothesis (50), and $s$ is the sample standard deviation.

- Add a write-up of the effect size compute above to your report. In other words, after reporting whether the t-test results are statistically significant, are your results also of practical significance (i.e. important)?

- Check whether the t-test assumptions are satisfied.[^assumptions]

[^assumptions]: Hint: Recall that, for the t-test results to be valid, the following conditions need to be met:

    1. The data need to come from a random sample of the population
    2. Either:
        - The population follows a normal distribution (irrespectively of the sample size)
        - The sample size is large enough, $n \geq 30$ as a guideline.
        
    For (1), this is known from the study design description. For (2) some of these functions may be useful: `dim`, `nrow`, `geom_qq`, `geom_qq_line`, `shapiro.test`.

- Add a write-up of the assumptions check to your report.



## Worked Example

The R code is visible for instructional purposes only, but it should not be visible in a PDF report. No R code or output should be visible in a report, only text, figures, and tables.

::: {.callout-note collapse="true"}
#### R code

```{r echo=TRUE, eval=TRUE, results='hide', fig.show='hide'}
library(tidyverse)
library(patchwork)
library(kableExtra)

pass_scores <- read_csv("https://uoepsy.github.io/data/pass_scores.csv")
dim(pass_scores)
head(pass_scores)
glimpse(pass_scores)

summary(pass_scores)

plt_hist <- ggplot(pass_scores, aes(x = PASS)) + 
    geom_histogram(color = 'white') +
    labs(x = "PASS scores", title = "(a) Histogram")

plt_box <- ggplot(pass_scores, aes(x = PASS)) + 
    geom_boxplot() +
    labs(x = "PASS scores", title = "(b) Boxplot")

plt_hist / plt_box

stats <- pass_scores %>%
    summarise(n = n(),
              Min = min(PASS),
              Max = max(PASS),
              M = mean(PASS),
              SD = sd(PASS))

kbl(stats, booktabs = TRUE, digits = 2, 
    caption = "Descriptive statistics for PASS scores")

# Confidence interval
xbar <- stats$M
s <- stats$SD
n <- stats$n
se <- s / sqrt(n)
tstar <- qt(c(0.025, 0.975), df = n - 1)

xbar + tstar * se

# observed t-statistic
tobs <- (xbar - 33) / se
tobs

# p-value method
pvalue <- 2 * pt(abs(tobs), df = n - 1, lower.tail = FALSE)
pvalue

# critical values method
tstar
tobs

# effect size
D <- (xbar - 33) / s
D

# assumptions checks
dim(pass_scores)

plt_dens <- ggplot(pass_scores, aes(x = PASS)) + 
    geom_density() +
    labs(x = "PASS scores",
         title = "(a) Density plot")

plt_qq <- ggplot(pass_scores, aes(sample = PASS)) + 
    geom_qq() +
    geom_qq_line() +
    labs(x = "Theoretical quantiles",
         y = "Sample quantiles",
         title = "(b) QQ-plot")

plt_dens | plt_qq

shapiro.test(pass_scores$PASS)
```
:::


:::{.callout-note collapse="true"}
#### Introduction

A random sample of 20 students from the University of Edinburgh completed a questionnaire measuring their total endorsement of procrastination. The data, available from <https://uoepsy.github.io/data/pass_scores.csv>, were used to estimate the average procrastination score of all Edinburgh University students, as well as testing whether the mean procrastination score differed from the Solomon & Rothblum reported average of 33 at the 5% significance level. 
The recorded variables include a subject identifier (`sid`, categorical), the school each belongs to (`school`, categorical), and the total score on the Procrastination Assessment Scale for Students (`PASS`, numeric). The data do not include any impossible values for the PASS scores, as they were all within the possible range of 0 -- 90. To answer the questions of interest, in the following we will only focus on the total PASS score variable.

:::


:::{.callout-note collapse="true"}
#### Analysis

The distribution of PASS scores, as shown in @fig-pass-plt(a), is roughly bell shaped and does not have any impossible values. The outlier (40) depicted in the boxplot shown in @fig-pass-plt(b) is well within the range of plausible values for the PASS scale (0--90) and as such was not removed for the analysis. 

```{r, echo=FALSE, fig.height=5, fig.width = 6}
#| label: fig-pass-plt
#| fig-cap: Distribution of PASS scores for a sample of Edinburgh University students
plt_hist / plt_box
```

```{r, echo=FALSE}
#| label: tbl-pass-stats
#| tbl-cap: Descriptive statistics for PASS scores
kbl(stats, booktabs = TRUE, digits = 2) %>%
    kable_styling(full_width = FALSE)
```

@tbl-pass-stats displays summary statistics for the PASS scores in the sample of Edinburgh University students. From the sample data we obtain an average procrastination score of $M = 30.7$, 95% CI [29.15, 32.25]. Hence, we are 95% confident that a Edinburgh University student will have a procrastination score between 29.15 and 32.25, which is between 0.75 and 3.85 lower than the average score of 33 reported by Solomon & Rothblum.

Let $\mu$ denote the mean PASS score of all Edinburgh University students. At the 5% significance level, we performed a one sample t-test of $H_0 : \mu = 33$ against $H_1 : \mu \neq 33$.
The sample data provide very strong evidence against the null hypothesis and in favour of the alternative one that the mean procrastination score of Edinburgh University students is significantly different from the Solomon & Rothblum reported average of 33: $t(19) = -3.11, p = .006$, two-sided. The size of the effect was also found to be medium, $D = -0.69$.

```{r, echo=FALSE}
#| label: fig-pass-assumptions
#| fig-cap: Density plot (a) and QQ-plot (b) of PASS scores for a sample of Edinburgh University students
plt_dens | plt_qq
```

The sample data did not show violations of the assumptions required for the t-test results to be valid. Specifically, the data were collected on a random sample of students from Edinburgh University, hence independence was met. @fig-pass-assumptions(a) shows that the distribution of PASS scores is roughly bell-shaped, with a single mode and as such does not raise any concerns of violations of normality. Similarly, the QQ-plot in @fig-pass-assumptions(b) shows agreement between the sample and theoretical quantiles, as they almost all fall on the line. At the 5% significance level, we also performed a Shapiro-Wilk test against the null hypothesis of normality of the population data: $W = 0.94$, $p = .20$. The sample data do not provide sufficient evidence to reject the null hypothesis that the population data follow a normal distribution.
:::


:::{.callout-note collapse="true"}
#### Discussion
Data including the Procrastination Assessment Scale for Students (PASS) scores for a random sample of 20 students at Edinburgh University we used to estimate the average procrastination score for a student of that university. In addition, the data were used to test whether there is a significant difference between that average score and the Solomon & Rothblum reported average of 33.

We are 95% confident that a Edinburgh University student will have a procrastination score between 29.15 and 32.25. Furthermore, at the 5% significance level, the data provide very strong evidence that the mean procrastination score of Edinburgh University students is different from 33. The confidence interval, reported above, indicates that a Edinburgh University student tends to have a mean procrastination score between 0.75 and 3.85 lower than the Solomon & Rothblum reported average of 33.
:::

What is missing from this instructional example:

- Appendix A
- Appendix B
