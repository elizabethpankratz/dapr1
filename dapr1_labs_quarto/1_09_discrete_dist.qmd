---
title: "Random Variables (Discrete)"
subtitle: "Semester 1 - Week 9"
callout-appearance: simple
---

```{r setup}
#| include: false

set.seed(532)
source('assets/setup.R')
library(tidyverse)

movies <- read_csv("https://uoepsy.github.io/data/hollywood_movies_subset.csv")

movies2 <- movies %>%
    filter(Genre %in% c("Drama", "Action", "Comedy")) %>%
    mutate(Rating = ifelse(AudienceScore <= 50, 'Bad', 'Good')) %>%
    mutate(Genre = factor(Genre),
           Rating = factor(Rating))

movies_prop <- table(movies2$Genre, movies2$Rating) %>%
    prop.table() %>%
    addmargins()
movies_prop

movies_prop[, 2] / movies_prop[, 3]

library(ggmosaic)
m_plot <- ggplot(movies2) +
    geom_mosaic(aes(x = product(Rating), fill = Rating, conds = product(Genre)))
m_plot
```

::: {.callout-note collapse="true"}
### Instructions Recap - Formative Report B

- In this block of the course (weeks 7-11), you should produce a PDF report using Rmarkdown for which you will receive formative feedback in week 12. 

- The report should not include any reference to R code or functions, but be written or a generic reader who is only assumed to have a basic statistical understanding without any R knowledge. You should also avoid any R code output or printout in the PDF file.

- You will be required to submit a PDF file by 12 noon on Friday the 2nd of December 2022 via Learn. One person needs to submit on behalf of your group.

- The report should be at most 6 pages long. At the end of the report, you are allowed two appendices which both don't count towards the page limit. 

    + Appendix A will contain any tables or figures which you cannot fit in the page limit (no text allowed)
    + Appendix B will contain the code to reproduce the report results (just like Formative Report A).

- No extensions allowed. As this is group-based work, no extensions are possible.
:::

::: {.callout-note collapse="true"} 
### Formative report B - Data

**Hollywood Movies**. At the link <https://uoepsy.github.io/data/hollywood_movies_subset.csv> you will find data on Hollywood movies released between 2012 and 2018 from the top 5 lead studios and top 10 genres. The following variables were recorded:

- `Movie`: Title of the movie 
- `LeadStudio`: Primary U.S. distributor of the movie 
- `RottenTomatoes`: Rotten Tomatoes rating (critics) 
- `AudienceScore`: Audience rating (via Rotten Tomatoes) 
- `Genre`: One of Action Adventure, Black Comedy, Comedy, Concert, Documentary, Drama, Horror, Musical, Romantic Comedy, Thriller, or Western 
- `TheatersOpenWeek`: Number of screens for opening weekend 
- `OpeningWeekend`: Opening weekend gross (in millions) 
- `BOAvgOpenWeekend`: Average box office income per theater, opening weekend 
- `Budget`: Production budget (in millions) 
- `DomesticGross`: Gross income for domestic (U.S.) viewers (in millions) 
- `WorldGross`: Gross income for all viewers (in millions) 
- `ForeignGross`: Gross income for foreign viewers (in millions) 
- `Profitability`: WorldGross as a percentage of Budget 
- `OpenProfit`: Percentage of budget recovered on opening weekend 
- `Year`: Year the movie was released
- `IQ1`-`IQ50`: IQ score of each of 50 audience raters
- `Snacks`: How many of the 50 audience raters brought snacks
- `PrivateTransport`: How many of the 50 audience raters reached the cinema via private transportation

:::

## Tasks

For formative report B, you will be asked to perform the following tasks, each related to a week of teaching in this course.  

__This week you will only focus on task B3.__ 

B1) Create and summarise categorical variables, before calculating probabilities. 
B2) Investigate if events are independent, and compute probabilities.  

:::{.callout-note}
### This week's task
B3) Computing and plotting probabilities with a binomial distribution.
:::
  
B4) Computing and plotting probabilities with a normal distribution.  
B5) Plot standard error of the mean, and finish the report write-up (i.e., knit to PDF, and submit the PDF for formative feedback).  

## B3 sub-tasks

::: {.callout-tip}
### Tip

To see the hints, hover your cursor on the superscript numbers.
:::

In this section you will find some guided sub-steps you may want to consider to complete task B3.

- Reopen last week's Rmd file, as you will continue last week's work, and build on it.[^share-file]

[^share-file]: Hint: Ask last week's driver for the Rmd file, they should share it with the group via email or Teams. To download the file from the server, go to the RStudio Files pane, tick the box next to the Rmd file, and select More > Export.

- A new movie theatre is opening in Texas, and the management team are reviewing the requirements of their snack stalls. A [recent survey](http://fj.webedia.us/features/snack-statistics-surveyme-findings-reveal-moviegoers-concession-preferences) suggested that 49% of movie viewers always buy some form of snack item (i.e., popcorn, drinks, sweets) when watching a movie. Estimate how many viewers out of the 50 who watched each movie from the the top 3 genres bought a snack.[^snack-rbinom]

[^snack-rbinom] Here we need to use the function `rbinom()`, as we are interested in randomly sampling trials from a binomial distribution. The function `rbinom()` will require you to state three arguments: (1) n - the number of trials to sample, (2) size - the number of events associated with each trial, and (3) prob - the probability of an event occurring.

```{r}
snack_est <- rbinom(299, 50, 0.49)
snack_est
```

- What is the probability that exactly half of the audience for each movie (i.e., 25 viewers) bought snacks[^snack-dbinom]?

[^snack-dbinom] Here we need to use the function `dbinom()`, as we are interested in the probability of getting one specific result. The function `dbinom()` will require you to state three arguments: (1) x - the number of 'successful' outcomes that you expect, (2) size - the number of events, and (3) prob - the probability of success on a given event.

```{r}
snack_25 <- dbinom(25, 50, 0.49)
snack_25
```

- What is the probability that more than half of the audience for each movie (i.e., **more than** 25 viewers) bought snacks[^snack-pbinom]?

[^snack-pbinom] Here we need to use the function `pbinom()`, as we are interested in the cumulative probability of getting a specific result. The function `pbinom()` will require you to state four arguments: (1) q - the number of 'successful' outcomes that you expect, (2) size - the number of events, (3) prob - the probability of success on a given event, and (4) lower.tail - specify which side of the probability distribution to test from, where TRUE if looking for 'less than', or FALSE if 'more/greater than'. 

```{r}
snack_cumul_prob <- pbinom(25, 50, 0.49, lower.tail=FALSE)
snack_cumul_prob
```

- Using `ggplot()`, visualise the binomial distribution of snacks, making sure to add a main title and clear axis titles.[^func-dist]

[^func-dist] On our y axis, we want include percentages (not counts), so we should use `..prop..` as the y variable. It would also be useful to ensure that your x-axis covers the full range of possible values (i.e., 0-50) - you can specify this using the argument `xlim()`.

```{r}
snack_plot <- ggplot() +
    geom_bar(data = movies2, aes(x = snack_est, y = ..prop..)) + 
    xlim(0, 50) + 
    labs(title = "Probability of snack purchase for \n50 viewers of each movie")
snack_plot
```

- Based on the probabilities you have reported above, do you think that the new movie theatre should invest in multiple snack stations, or just one? Justify your answer. 

- As noted above, the new movie theatre is still in the planning phase, so planners are reviewing whether they should increase their car park space, or add a bus stop on the theatre grounds. A [recent survey](http://fj.webedia.us/features/snack-statistics-surveyme-findings-reveal-moviegoers-concession-preferences) suggested that 70% of movie viewers travel to the cinema via private transport. Estimate how many viewers out of the 50 who watched each movie from the the top 3 genres traveled via private transport?

```{r}
transport_est <- rbinom(299, 50, 0.70)
```

- What is the probability that exactly half of the audience for each movie (i.e., 25 viewers) traveled via private transport?

```{r}
transport_25 <- dbinom(25, 50, 0.70)
```

- What is the probability that less than half of the audience for each movie (i.e., less than 25 viewers) traveled via private transport?

```{r}
transport_cumul_prob <- pbinom(25, 50, 0.70)
transport_cumul_prob
```

- Using `ggplot()`, visualise the binomial distribution of snacks, making sure to add a main title and clear axis titles.

```{r}
transport_plot <- ggplot() +
    geom_bar(data = movies2, aes(x = transport_est, y = ..prop..)) + 
    xlim(0, 50) + 
    labs(title = "Probability of using private transport for \n50 viewers of each movie")
transport_plot
```

- Based on the probabilities you have reported above, do you think that the new movie theatre should add a bus stop on theatre grounds, or increase their car park capacity? Justify your answer. 

- In the analysis section of your report, write up a summary of what you have reported above, using proper rounding to 2 decimal places and avoiding any reference to R code or functions. 

## Worked Example

Consider the dataset available at <https://uoepsy.github.io/data/RestaurantTips2.csv>, containing 99 observations on the following 8 variables:

```{r, echo=FALSE}
library(tidyverse)
library(kableExtra)

tribble(
    ~'Variable Name', ~'Description',
    'Bill', 'Size of the bill (in dollars)',
    'Tip', 'Size of the tip (in dollars)',
    'Credit', 'Paid with a credit card? n or y',
    'Guests', 'Number of people in the group',
    'Day', 'Day of the week: m=Monday, t=Tuesday, w=Wednesday, th=Thursday, or f=Friday',
    'Server', 'Code for specific waiter/waitress: A, B, or C',
    'PctTip', 'Tip as a percentage of the bill',
    'HadCoffee', 'Number of guests in the group who had coffee'
) %>%
    kbl() %>%
    kable_styling(full_width = FALSE)
```

These data were collected by the owner of a bistro in the US, who was interested in understanding the tipping patterns of their customers. The data are adapted from @lock2020.

```{r}
library(tidyverse)  # we use read_csv and glimpse from tidyverse
tips <- read_csv("https://uoepsy.github.io/data/RestaurantTips2.csv")
tips <- read_csv("C:/DAPR Labs/dapr1/internal_data/sem1/RestaurantTips2.csv")
head(tips)
```

The owner of the bistro is interested in coffee sales, and whether they should consider introducing a 2 for 1 coffee deal to entice customers to purchase one of their Christmas coffees. Another option they are considering is starting a loyalty scheme for customers to be rewarded for every coffee purchase. Your job is to advise them on which scheme they should run to benefit most customers. For context, Americans drink *a lot* of coffee, and although slightly less than Norwegians (where 89.4% of (Norwegians drink at least one coffee per day!)[]), it is estimated that approximately 75% of US residents drink coffee. 

- If we wanted to estimate how many guests out of each group ordered a coffee at the Bistro, we could calculate the following: 

```{r}
est <- rbinom(99, 2, 0.75)
est
```

- If we wanted to calculate the probability that exactly 1 person from each group ordered a coffee, we would calculate the following:

```{r}
exact <- dbinom(1, 2, 0.75)
exact
```
- If we wanted to calculate the probability that more than 1 person from the group ordered a coffee, we would calculate the following:

```{r}
prob <- pbinom(1, 2, 0.75, lower.tail = FALSE)
prob
```

- To visualise our findings, we could use a plot the proportion of groups of customers who bought 0, 1, or 2 coffees:

```{r}
#| label: fig-coffee
#| fig-cap: "Probability of groups of 2 purchasing a coffee"
coffee_plot <- ggplot() +
    geom_bar(data = tips, aes(x = est, y = ..prop..)) + 
    xlim(-1,3) + 
    labs(title = "Probability of groups of 2 \npurchasing a coffee")
coffee_plot

```

:::{.callout-tip}

#### Example writeup

The owner of the bistro should not consider running a 2 for 1 offer on Christmas coffees. It is most likely that groups of two customers will already buy two coffees when they visit the bistro (64%). Instead, the owner might want to offer a loyalty scheme to reward customers for purchasing coffees, regardless of the quantity, as this will also reward parties of two where only one person purchases a coffee. This proabability distribution is visually represented in @fig-coffee.

:::

## Student Glossary

To conclude the lab, add the new functions to the glossary of `R` functions. 

| Function   | Use and package |
|:-----------|:--------------|
| `rbinorm() `     | ? |
| `pbinom()`      | ? |
| `dbinom() `     | ? |

