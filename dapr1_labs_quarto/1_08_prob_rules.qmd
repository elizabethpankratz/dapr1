---
title: "Probability Rules"
subtitle: "Semester 1 - Week 8"
callout-appearance: simple
---

```{r setup}
#| include: false

source('assets/setup.R')
library(tidyverse)
movies <- read_csv("https://uoepsy.github.io/data/hollywood_movies_subset.csv")
```


::: {.callout-note collapse="true"}
### Instructions Recap - Formative Report B

- In this block of the course (weeks 7-11), you should produce a PDF report using Rmarkdown for which you will receive formative feedback in week 12. 

- The report should not include any reference to R code or functions, but be written or a generic reader who is only assumed to have a basic statistical understanding without any R knowledge. You should also avoid any R code output or printout in the PDF file.

- You will be required to submit a PDF file by 12 noon on Friday the 2nd of December 2022 via Learn. One person needs to submit on behalf of your group.

- The report should be at most 6 pages long. At the end of the report, you are allowed two appendices which both don't count towards the page limit. 

    + Appendix A will contain any tables or figures which you cannot fit in the page limit (no text allowed)
    + Appendix B will contain the code to reproduce the report results (just like Formative Report A).

- No extensions allowed. As this is group-based work, no extensions are possible.
:::


::: {.callout-note collapse="true"} 
### Formative report B - Data

**Hollywood Movies**. At the link <https://uoepsy.github.io/data/hollywood_movies_subset.csv> you will find data on Hollywood movies released between 2012 and 2018 from the top 5 lead studios and top 10 genres. The following variables were recorded:

- `Movie`: Title of the movie 
- `LeadStudio`: Primary U.S. distributor of the movie 
- `RottenTomatoes`: Rotten Tomatoes rating (critics) 
- `AudienceScore`: Audience rating (via Rotten Tomatoes) 
- `Genre`: One of Action Adventure, Black Comedy, Comedy, Concert, Documentary, Drama, Horror, Musical, Romantic Comedy, Thriller, or Western 
- `TheatersOpenWeek`: Number of screens for opening weekend 
- `OpeningWeekend`: Opening weekend gross (in millions) 
- `BOAvgOpenWeekend`: Average box office income per theater, opening weekend 
- `Budget`: Production budget (in millions) 
- `DomesticGross`: Gross income for domestic (U.S.) viewers (in millions) 
- `WorldGross`: Gross income for all viewers (in millions) 
- `ForeignGross`: Gross income for foreign viewers (in millions) 
- `Profitability`: WorldGross as a percentage of Budget 
- `OpenProfit`: Percentage of budget recovered on opening weekend 
- `Year`: Year the movie was released
- `IQ1`-`IQ50`: IQ score of each of 50 audience raters
- `Snacks`: How many of the 50 audience raters brought snacks
- `PrivateTransport`: How many of the 50 audience raters reached the cinema via private transportation

:::

## Tasks

For formative report B, you will be asked to perform the following tasks, each related to a week of teaching in this course.  

__This week you will only focus on task B2.__ 


B1) Create and summarise categorical variables, before calculating probabilities. 

:::{.callout-note}
### This week's task
B2) Investigate if events are independent, and compute probabilities.  
:::

B3) Computing and plotting probabilities with a binomial distribution.  
B4) Computing and plotting probabilities with a normal distribution.  
B5) Plot standard error of the mean, and finish the report write-up (i.e., knit to PDF, and submit the PDF for formative feedback).  

## B2 sub-tasks

::: {.callout-tip}
#### Tip

To see the hints, hover your cursor on the superscript numbers.
:::

In this section you will find some guided sub-steps you may want to consider to complete task B2.

```{r, results='hide', echo = FALSE, message = FALSE}
# sort the frequency table
sort(table(starwars$species))
    
# or, for decreasing order, you can use:
sort(table(starwars$species), decreasing = TRUE)
    
# keep only the rows where species is Human, Droid, Wookiee, or Ewok
# in R, or is the vertical bar |
starwars2 <- starwars %>% 
     filter(species == "Human" | species ==  "Droid" | species == "Wookiee" | species == "Ewok")

starwars2 <- starwars2 %>%
    mutate(size = ifelse(height < 180, 's', 't'))

starwars2$size <- factor(starwars2$size,
                        levels = c("s", "t"),
                        labels = c("short", "tall"))

starwars2$species <- factor(starwars2$species)

swars_rel_freq_sum <- table(starwars2$species, starwars2$size) %>%
        prop.table() %>%
        addmargins()

swars_rel_freq_sum

starwars2 <- starwars2 %>%
    drop_na(size) %>%
    mutate(size = factor(size))
```

- Reopen last week's Rmd file, as you will continue last week's work (i.e., the top 3 most frequent movie genres that were rated as 'good' and 'bad'), and build on it[^share-file].

[^share-file]: Hint: Ask last week's driver for the Rmd file, they should share it with the group via email or Teams. To download the file from the server, go to the RStudio Files pane, tick the box next to the Rmd file, and select More > Export.

- What’s the probability of a movie being rated as Good[^p-good]?

[^p-good]: Hint: If we were to ask whats the probability of a species being short (i.e., P(short)), we would calculate the following: 

    P(Droid and short) + P(Ewok and short) + P(Human and short) + P(Wookiee and short) = 0.10256410 + 0.02564103 + 0.38461538 + 0.00000000 = 0.51282051 ≈ 0.51.
                 
    Alternatively, we would use look in the "Sum" value under the "short" column of our table. 

    ```{r}
    swars_rel_freq_sum
    #P(short) = 0.51282051 ≈ 0.51
    ```

- Given that a viewer watched a Drama movie, what's the probability of them giving a good rating[^p-genre-good]?

[^p-genre-good]: Hint: If we were to ask whats the probability of being short for the Human species(i.e., P(short | human)), we could calculate the following:
                    P(short | human) = (0.38461538 / 0.79487179) = 0.483871 ≈ 0.48. 

    ```{r}
    swars_rel_freq_sum
    #P(short | human) = (0.38461538 / 0.79487179) = 0.483871 ≈ 0.48 
    ```

- Given that a viewer watched an Action movie, what's the probability of them giving a good rating?

- Given that a viewer watched a Comedy movie, what's the probability of them giving a good rating?

- What’s the probability of viewer watching a non-comedy movie **and** rating it as Bad[^p-bad]?

[^p-bad]: Hint: If we were to ask whats the probability of a non-human being short, we could calculate the following:

```{r}
#Need to update solution!!!!!!!!!!!!!!!!!!!!!
```


- What’s the probability of a rater watching a Drama movie **or** rating a movie as Bad[^p-dr-bad]?

[^p-dr-bad]: Hint: If we were to ask whats the probability of a species being Droid or being tall (i.e., P(Droid or tall)), we would compute the probability as follows: 

    ```{r}
    swars_rel_freq_sum
    #P(Droid) = 0.12820513 ≈ 0.13
    #P(tall) = 0.48717949 ≈ 0.49
    #P(Droid ∩ tall) = 0.02564103 ≈ 0.03
    
    #P(Droid) + P(tall) - P(Droid ∩ tall) = (0.13 + 0.49) - 0.03
    # ≈ 0.59
    ```

- Do you think that a movie receiving a Good rating is independent of Genre?[^genre-indep]

[^genre-indep]: Hint: Recall that we say that two events $A$ and $B$ are independent if knowing that one occurred doesn’t change the probability of the other occurring. In our example, we would say that the events seem to be dependent, given that the conditional probabilities are different from P(short). For example, the probability of being short for Ewoks and Droids is much higher than $P(short)$:

    ```{r}
    #P(short) ≈ 0.51
    #P(short | droid) ≈ 0.80
    #P(short | ewok) ≈ 1
    #P(short | human) ≈ 0.48
    #P(short | wookiee) ≈ 0
    ```

- Based on your analysis above, which movie Genre do you think lead studios should invest in for their next movie[^genre-invest]?

[^genre-invest]: Hint: Here it would be useful to think about which movie genre offers the best audience experience - lead studios will likely want to invest in making movies in Genres that people enjoy watching!

- Visualise the relative frequency table as a conditional mosaic plot, making sure to add a main title and clear axis titles.[^func-mosaic]

[^func-mosaic]: Hint: Make sure to load the `ggmosaic()` package so that you can specify `geom_mosaic()` when building your plot. To add a title, as well as x- and y-axis titles, specify `labs(title = , x = , y = )`. This week we will also need to specify the `conds()` argument. 

    Example: For the `starwars` dataset, I create a mosaic plot using the following code, and specify conds() within my aes() argument:

    ```{r}
    #| label: fig-swars1
    #| fig-cap: "Starwars Mosaic Plot Example Title"
    library(ggmosaic)
    m_plot <- ggplot(starwars2) +
        geom_mosaic(aes(x = product(size), fill = size, conds = product(species))) +
        labs(title = "Starwars Conditional Mosaic Plot Example", 
             x = "Species", 
             y = "Size",
             fill = "Size")
    m_plot
    ```

- In the analysis section of your report, write up a summary of what you have reported above, using proper rounding to 2 decimal places and avoiding any reference to R code or functions. In particular, focus on whether events were independent, and which genre of movie lead studios should consider investing in based on audience ratings.[^proper-notation] 

[^proper-notation]: Hint: You may want to consider using proper notation in your write-up (as you have seen in lectures). To do so, you can use `$ name $`. For example, if I wanted to specify the general addition rule, in the main Rmd file (i.e., not a code chunk) I could write `$p(A \bigcup B) = p(A) + p(B) - p(A \bigcap B)$`. This would render in my main file as:

    $p(A \bigcup B) = p(A) + p(B) - p(A \bigcap B)$

## Worked Example

Consider the dataset available at <https://uoepsy.github.io/data/RestaurantTips.csv>, containing 157 observations on the following 7 variables:

```{r, echo=FALSE}
library(tidyverse)
library(kableExtra)

tribble(
    ~'Variable Name', ~'Description',
    'Bill', 'Size of the bill (in dollars)',
    'Tip', 'Size of the tip (in dollars)',
    'Credit', 'Paid with a credit card? n or y',
    'Guests', 'Number of people in the group',
    'Day', 'Day of the week: m=Monday, t=Tuesday, w=Wednesday, th=Thursday, or f=Friday',
    'Server', 'Code for specific waiter/waitress: A, B, or C',
    'PctTip', 'Tip as a percentage of the bill'
) %>%
    kbl() %>%
    kable_styling(full_width = FALSE)
```

These data were collected by the owner of a bistro in the US, who was interested in understanding the tipping patterns of their customers. The data are adapted from @lock2020.

```{r}
library(tidyverse)  # we use read_csv and glimpse from tidyverse
tips <- read_csv("https://uoepsy.github.io/data/RestaurantTips.csv")
head(tips)
```

Working with the "Tip_Avg" variable created last week, we can see our relative frequency table for all of our servers (A, B, and C) who were tipped either Above or Below the standard tipping rate in the US (i.e., 15%). 


```{r}
tips2 <- tips %>%
    mutate(Tip_Avg = ifelse(PctTip <=15, 'Below', 'Above'))

rel_freq_tbl <- table(tips2$Server, tips2$Tip_Avg) %>%
    prop.table() %>%
    addmargins()
rel_freq_tbl

```


- What’s the probability of a customer tipping above average?

```{r}
#P(above) = 0.25477707 + 0.25477707 + 0.12738854
#P(above) = 0.63694268
```

$P(Above) ≈ 0.64$

- What’s the probability of server A receiving an above average tip?

```{r}
#P(above | server A) = 0.25477707 / 0.38216561
#P(above | server A) = 0.6666667
```

$P(Above | Server A) ≈ 0.67$

- What’s the probability of server B receiving an above average tip?

```{r}
#P(above | server B) = 0.25477707 / 0.41401274
#P(above | server B) = 0.6153846
```

$P(Above | Server B) ≈ 0.62$

- What’s the probability of server C receiving an above average tip?

```{r}
#P(above | server C) = 0.12738854 / 0.20382166
#P(above | server C) = 0.625
```

$P(Above | Server C) ≈ 0.63$

- What’s the probability of Server A or B receiving a below average tip?

```{r}
#Need to update solution!!!!!!!!!!!!!!!!!!!!!
#P(below | server A) + P(below | server B)
0.12738854 + 0.15923567
# 0.2866242
```

$P(Below | Server A or B) ≈ 0.29$

- What’s the probability of the customer being served by server A **or** tipping below 15%?

```{r}
#P(server A) = 0.38216561
#P(below) = 0.36305732
#P(server A ∩ below) = 0.12738854

#P(server A) + P(below) - P(server A ∩ below) = (0.38216561 + 0.36305732) - 0.12738854
# ≈ 0.62
```

$P(Server A or Below) ≈ 0.62$

- Is tipping above average independent of the server?

No, the events seem to be dependent. The conditional probabilities are different from P(above), even though to a small degree. In particular, the probability of tipping above average after service from Server A is higher.

- Based on your analysis above, which server do you think offers the best customer service based on their tips?

Server A appears to offer the best service to their customers, based solely on their personal tips - they had a much higher probability of receiving an above average tip (67%) than a below average tip (33%).

- To visualise our findings, we could use a conditional mosaic plot:

```{r}
#| label: fig-mos_cond_plot
#| fig-cap: "Conditional Association between Servers and Tips"
library(ggmosaic)
mos_cond_plot <- ggplot(tips2) +
    geom_mosaic(aes(x = product(Tip_Avg), fill = Tip_Avg, conds = product(Server))) +  
    labs(title = "Conditional Association between Servers and Tips", x = "Server", y = "Tip Average", fill = "Tip Average")
mos_cond_plot
```

:::{.callout-tip}
#### Example writeup

It was more likely for customers to tip above (64%) than below (36%) average. Though it was likely that all servers would receive an above average tip, tipping did not appear to be independent of server, based on conditional probabilities. Based on their personal tips, Server A appeared to offer the best service, where they were more likely to receive an above average tip (67%). Servers B and C were almost equally likely to receive above average tips (62% and 63% respectively). These associations are visually represented in @fig-mos_cond_plot.

:::

```{r}
# Is P(server A and above) equal to P(server A) * P(above) ?


0.38216561 * 0.63694268 #P(Server A) * P(Above)
#0.25477707 is P(Server A ∩ Above)
```


## Student Glossary

To conclude the lab, add the new functions to the glossary of `R` functions. 

| Function   | Use and package |
|:-----------|:--------------|
| ` |  `     | ? |
| `/`        | ? |
| ` conds  ` | ? |

